// GigaScroll
// version: 0.0.7
// author: Mattias Petter Johansson <mpj@mpj.me> http://mpj.me
// license: MIT
'use strict';function createNativeStringTemplateEngine(){var i=function(a){var b={},c=a;this.data=function(a,c){if(!c)return b[a];b[a]=c};this.text=function(a){if(!a)return c;c=a}},d={},b=new ko.nativeTemplateEngine;b.makeTemplateSource=function(a){return d[a]};b.addTemplate=function(a,b){d[a]=new i(b)};return b};(function(){ko.bindingHandlers.gigaScroll={init:function(i,d){var b=d(),a=i.innerHTML,j=createNativeStringTemplateEngine();j.addTemplate("gigaScroll",'        <div id="gigaViewport">          <div id="gigaRiver" data-bind="style: { height: gigaDivHeight() + \'px\' }">            <div class="gigaRaft" data-bind="style: { paddingTop: offsetTop() + \'px\' }">              <ul data-bind="foreach: visibleItems">                '+a+"              </ul>            </div>          </div>        </div>");
ko.renderTemplate("gigaScroll",b,{templateEngine:j},i,"replaceNode");var c=document.getElementById("gigaViewport");c.style.width="100%";c.style.height="100%";c.style.overflowY="scroll";a=function(){b.setViewPortHeight(c.offsetHeight)};a();window.addEventListener("resize",a);c.addEventListener("scroll",function(){b.setScrollPosition(c.scrollTop)});var h=c.getElementsByTagName("UL")[0];h.style.margin=0;h.style.padding=0;h.style.border=0;var f=function(a){"LI"===a.target.nodeName&&(b.setElementHeight(a.target.offsetHeight),
h.removeEventListener("DOMNodeInserted",f,!1))};h.addEventListener("DOMNodeInserted",f,!1);b.setElementHeight(20)}}})();function GigaScrollViewModel(i){function d(a){return ko.computed({read:a,deferEvaluation:!0})}this.visibleItems=d(function(){var e,d;if(null===b()||null===a)return[];e=b()-a();e=Math.max(e,0);d=3*a();a:{for(var g=e,f=d;c()[g];)g++,f--;for(;c()[g+f-1];)if(f--,1>f)break a;clearTimeout(j);j=setTimeout(function(){i.load(g,f,function(a,e){h(e);for(var b=0;b<f;b++)c()[g+b]=a[b];c.valueHasMutated()})},100)}d=Array(a());for(e=0;e<a();e++)d[e]=c()[b()+e],d[e]||(d[e]={}),d[e].cacheIndex=b()+e;return d});this.offsetTop=
d(function(){return b()*g()});this.gigaDivHeight=d(function(){return h()*g()});this.setViewPortHeight=function(a){f(a)};this.setElementHeight=function(a){g(a)};this.setScrollPosition=function(a){k(a)};var b=d(function(){if(null===k()||null===g())return null;var b=h()-a(),c=Math.floor(k()/g());return Math.min(b,c)}),a=d(function(){return null===f()||null===g()?null:Math.ceil(f()/g())}),j=null,c=ko.observableArray(),h=ko.observable(null),f=ko.observable(null),g=ko.observable(null),k=ko.observable(0)}
;
