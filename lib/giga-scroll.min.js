// GigaScroll
// version: 0.0.5
// author: Mattias Petter Johansson <mpj@mpj.me> http://mpj.me
// license: MIT
'use strict';function createNativeStringTemplateEngine(){var i=function(a){var c={},d=a;this.data=function(a,d){if(!d)return c[a];c[a]=d};this.text=function(a){if(!a)return d;d=a}},b={},c=new ko.nativeTemplateEngine;c.makeTemplateSource=function(a){return b[a]};c.addTemplate=function(a,c){b[a]=new i(c)};return c};(function(){ko.bindingHandlers.gigaScroll={init:function(i,b){var c=b(),a=i.innerHTML,j=createNativeStringTemplateEngine();j.addTemplate("gigaScroll",'        <div id="viewport">          <div id="gigaDiv" data-bind="style: { height: gigaDivHeight() + \'px\' }">            <ul data-bind="foreach: visibleItems, style: { paddingTop: offsetTop() + \'px\' }">              '+a+"            </ul>          </div>        </div>");ko.renderTemplate("gigaScroll",c,{templateEngine:j},i,"replaceNode");var d=
document.getElementById("viewport");d.style.width="100%";d.style.height="100%";d.style.overflowY="scroll";a=function(){c.setViewPortHeight(d.offsetHeight)};a();window.addEventListener("resize",a);d.addEventListener("scroll",function(){c.setScrollPosition(d.scrollTop)});var h=d.getElementsByTagName("UL")[0];h.style.margin=0;h.style.padding=0;h.style.border=0;var e=function(a){"LI"===a.target.nodeName&&(c.setElementHeight(a.target.offsetHeight),h.removeEventListener("DOMNodeInserted",e,!1))};h.addEventListener("DOMNodeInserted",
e,!1);c.setElementHeight(20)}}})();function GigaScrollViewModel(i){function b(a){return ko.computed({read:a,deferEvaluation:!0})}this.visibleItems=b(function(){var g,b;if(null===c()||null===a)return[];g=c()-a();g=Math.max(g,0);b=3*a();a:{for(var f=g,e=b;d()[f];)f++,e--;for(;d()[f+e-1];)if(e--,1>e)break a;clearTimeout(j);j=setTimeout(function(){i.load(f,e,function(a,c){h(c);for(var b=0;b<e;b++)d()[f+b]=a[b];d.valueHasMutated()})},100)}b=Array(a());for(g=0;g<a();g++)b[g]=d()[c()+g];return b});this.offsetTop=b(function(){return c()*f()});
this.gigaDivHeight=b(function(){return h()*f()});this.setViewPortHeight=function(a){e(a)};this.setElementHeight=function(a){f(a)};this.setScrollPosition=function(a){k(a)};var c=b(function(){return null===k()||null===f()?null:Math.floor(k()/f())}),a=b(function(){return null===e()||null===f()?null:Math.ceil(e()/f())}),j=null,d=ko.observableArray(),h=ko.observable(null),e=ko.observable(null),f=ko.observable(null),k=ko.observable(0)};
